@page
@model SMARTLY.Pages.CartClientModel
@{
	Layout = "/Pages/Shared/_LayoutClient.cshtml";
}
<section id="hero" class="d-flex align-items-center ftco-section">
    @* <link rel="_Cart_Layout" href="/_Cart_Layout.html">*@
    <div class="container py-5 h-100">
        <div class="row d-flex justify-content-center align-items-center h-100">

            <input hidden asp-for="@Model.id" />
            <div class="col-12">

                <br />
                <br />
             
                <br />

                <br />

                <div class="card card-registration card-registration-2" ">
                    <div class="card-body p-0">

                        <div class="row g-0">
                            <div class="col-lg-8">
                                <div class="p-5">
                                    <div class="d-flex justify-content-between align-items-center mb-5">
                                        <br />
                                        <br />
                                        <br />

                                        <h1 class="fw-bold mb-0 text-black">My Cart</h1>
                                        <h6 class="mb-0 text-muted">items @Model.carttable.Rows.Count</h6>
                                    </div>
                                    <div class="product-container">
                                    @for(int i =0 ; i < Model.carttable.Rows.Count; i++)
                                    {
                                        Model.dt = Model.returnrecordofproduct(Convert.ToInt32(Model.carttable.Rows[i][1]));
                                         <hr class="my-4">
                                      
                                    <div class="row mb-4 d-flex justify-content-between align-items-center">
                                        <div class="col-md-2 col-lg-2 col-xl-2">
                                                <img src="@Model.dt.Rows[0][8]" class="img-fluid rounded-3" alt="Cotton T-shirt">
                                        </div>

                                         
                                        <div class="col-md-3 col-lg-3 col-xl-3">
                                                <h6 class="text-muted"> @Model.returnCategory((int)Model.dt.Rows[0][6])</h6>
                                                <h6 class="text-black mb-0">@Model.dt.Rows[0][1]</h6>
                                        </div>

                                        <div class="col-md-3 col-lg-3 col-xl-2 d-flex">

                                                <button class="btn btn-link px-2" onclick="decreaseQuantity(this)" >
                                                    <i class="fa fa-minus"></i>
                                                </button>
                                          
                                            
                                                <input asp-for="@Model.Quantity" data-price="@(Convert.ToDouble(Model.dt.Rows[0][9]))" id="form1" min="1" name="quantity" value="1" type="number" class="form-control form-control-sm" oninput="update()" />

                                                <button class="btn btn-link px-2" onclick="increaseQuantity(this)">
                                                    <i class="fa fa-plus"></i>
                                                </button>
                                            
                                        </div>
                                        <div class="col-md-3 col-lg-2 col-xl-2 offset-lg-1">
                                                <h6 class="mb-0">EGB @(Convert.ToDouble(Model.dt.Rows[0][9]) * Model.Quantity)</h6>

                                                @{Model.summary=Model.summary + (Convert.ToDouble(Model.dt.Rows[0][9]) * Model.Quantity);}
                                            </div>
                                        <div class="col-md-1 col-lg-1 col-xl-1 text-end">

                                                <div class="col-md-1 col-lg-1 col-xl-1 text-end">
                                                    <form method="get">
                                                        <input type="hidden" name="id" asp-for="@Model.deletedid" value="@Model.carttable.Rows[i][1]" />
                                                        <button asp-page-handler="Delete" type="submit" class="btn btn-link px-0">
                                                            <i class="fa fa-times"></i>
                                                        </button>
                                                    </form>
                                                </div>
                                           
                                          
                                        </div>
                                    </div>

                                    
                                    }
                                    </div>
                                    <hr class="my-4">

                                    <div class="pt-5">
                                        <h6 class="mb-0">
                                            <a href="/Product_MainClient" class="text-body">
                                                <i class="fa fa-arrow-left"> </i>  Back to shop
                                            </a>
                                        </h6>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-4 bg-grey">
                                <div class="p-5">
                                    <h3 class="fw-bold mb-5 mt-2 pt-1">Summary</h3>
                                    <hr class="my-4">

                                    <div class="d-flex justify-content-between mb-4">
                                        <h5 class="text-uppercase">items @Model.carttable.Rows.Count</h5>

                                        <h5>EGB @Model.summary </h5>
                                    </div>

                                    <h5 class="text-uppercase mb-3">Shipping</h5>

               

                                    <div class="mb-4 pb-2">
                                        <form>
                                            <select asp-asp-for="@Model.shipping" id="shippingOption" class="input-select1" name="selectedValu">
                                                <option value="1" data-cost="5">Standard-Delivery - EGB 5.00</option>
                                                <option value="2" data-cost="15">International - EGB 15.00</option>
                                                <option value="3" data-cost="30">Overnight - EGB 30.00</option>
                                                <option value="4" data-cost="50">Priority Mail - EGB 50</option>
                                            </select>
                                      
                                   
                                    </form>
                                    </div>


                                    <h5 class="text-uppercase mb-3">Promo code</h5>

                                    <div class="mb-5">
                                        <div class="form-outline">
                                            <input type="text" id="form3Examplea2" class="form-control form-control-lg" />

                                        </div>
                                    </div>
             
                                    <hr class="my-4">

                                    <div class="d-flex justify-content-between mb-5">
                                        <h5 class="text-uppercase">Total price</h5>
                                     
                                        <h5>
                                            EGB <input hidden id="shippingCosts" asp-for="shipping"> <span id="summaryTotal">
                            @(
                                Model.summary + Model.shipping
                                )</span>
                                            </input>
                                        </h5>
                </div>

            
                                    <button type="button" class="btn btn-dark btn-block btn-lg" style="display:block; margin: 0 auto;"
                                            data-mdb-ripple-color="dark">
                                        <a href="/CheckOut">
                                            Proceed To Payement
                                        </a>
                                    </button>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        // Get the select element and the shipping cost element
        const selectShipping = document.getElementById('shippingOption');
        const shippingCost = document.getElementById('shippingCosts');
        const summaryElement = document.getElementById('summaryTotal');

        // Define the shipping cost for each option
        const shippingCosts = {
            1: 5,
            2: 15,
            3: 30,
            4: 50
        };

        // Initialize the shipping cost to 5
        let currentShippingCost = 5;
        shippingCost.textContent = `EGB ${currentShippingCost.toFixed(2)}`;

        // Set the default selected option to the first one
        selectShipping.selectedIndex = 0;

        // Add event listeners for the change events
        selectShipping.addEventListener('change', update);
        document.querySelectorAll('input[name="quantity"]').forEach(function (input) {
            input.addEventListener('input', update);
        });

        function decreaseQuantity(button) {
            var input = button.parentNode.querySelector('input[type=number]');
            if (input.value > 1) {
                input.value = parseInt(input.value) - 1;
                update();
            }
        }

        function increaseQuantity(button) {
            var input = button.parentNode.querySelector('input[type=number]');
            input.value = parseInt(input.value) + 1;
            update();
        }

        function update() {
            // Get the updated quantity and calculate the total price
            var quantityInputs = document.querySelectorAll('input[name="quantity"]');
            var totalQuantity = 0;
            var totalPrice = 0;

            for (var i = 0; i < quantityInputs.length; i++) {
                var input = quantityInputs[i];
                var productPrice = parseFloat(input.getAttribute('data-price'));
                var quantity = parseInt(input.value);

                totalQuantity += quantity;
                totalPrice += productPrice * quantity;
            }

            // Update the summary and total price
            var summaryTotal = document.getElementById('summaryTotal');
            var selectShipping = document.getElementById('shippingOption');
            var selectedShippingOption = selectShipping.options[selectShipping.selectedIndex];
            var selectedShippingCost = parseFloat(selectedShippingOption.getAttribute('data-cost'));
            var totalPriceWithShipping = totalPrice + selectedShippingCost;

            summaryTotal.textContent = 'EGB ' + totalPriceWithShipping.toFixed(2);
        }
    </script>
    
    </section>